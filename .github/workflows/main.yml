name: AWS S3 Deployment
on:
  push:
    branches:
      - master
  workflow_dispatch:
jobs:
  deploy:
    name: Upload to S3 Bucket
    runs-on: ubuntu-20.04
    permissions:
      id-token: write
      contents: read
    steps:
      - name: Setup timezone
        uses: zcong1993/setup-timezone@v1.1.1
        with:
          timezone: Europe/Berlin
      - uses: actions/checkout@v2
      - name: Configure AWS OIDC credentials
        uses: aws-actions/configure-aws-credentials@v1
        with:
          role-to-assume: arn:aws:iam::304793766012:role/AWS-Deploy
          aws-region: eu-central-1
      - name: Copy resource files to the test website with the AWS CLI
        run: |
          aws s3 sync ./resources s3://pokemart-bucket
      - name: Copy indexfiles to the test website with the AWS CLI
        run: |
          aws s3 sync ./index.html s3://pokemart-bucket